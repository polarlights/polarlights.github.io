<!DOCTYPE html>
<html lang="en" itemscope itemtype="http://schema.org/WebPage">

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Method - Polarlights</title>
  

<meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta name="MobileOptimized" content="width"/>
<meta name="HandheldFriendly" content="true"/>


<meta name="applicable-device" content="pc,mobile">

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">

<meta name="mobile-web-app-capable" content="yes">

<meta name="author" content="polarlights" />
  <meta name="description" content="方法是一个有名代码块，与一个或多个对象相关联的参数化代码。调用方法时需要给出方法名、所在对象以及零个或多个与有名参数对应的参数值。方法中的最后一个表达式作为方法的返回值。 取消方法的定义取消方法的定义可以使用undef，但是如果想要取消单例方法，不能使用它。在方法或模块中可以使用undef_method。 def hello &#34;hello world&#34; end undef hello 定义方法的习惯方法的名词一般都是以小写字母命名的，如果方法是多个名词，那么用下划线" />

  <meta name="keywords" content="ruby, java, go, microservice, spring" />






<meta name="generator" content="Hugo 0.67.0" />


<link rel="canonical" href="https://polarlights.github.io/post/methods-procs-lambdas-and-closures/" />





<link rel="icon" href="/favicon.ico" />











<link rel="stylesheet" href="/sass/jane.min.fa3d941d1d0e0ddc985804227feabffea55c89883eb0af34e0532a7ae9135151.css" integrity="sha256-&#43;j2UHR0ODdyYWAQif&#43;q//qVciYg&#43;sK804FMqeukTUVE=" media="screen" crossorigin="anonymous">




<link rel="stylesheet" href="/css/prism.css">

<link rel="stylesheet" href="/css/adoc.css">

<link rel="stylesheet" href="/css/github.css">


<meta property="og:title" content="Method" />
<meta property="og:description" content="方法是一个有名代码块，与一个或多个对象相关联的参数化代码。调用方法时需要给出方法名、所在对象以及零个或多个与有名参数对应的参数值。方法中的最后一个表达式作为方法的返回值。 取消方法的定义取消方法的定义可以使用undef，但是如果想要取消单例方法，不能使用它。在方法或模块中可以使用undef_method。 def hello &#34;hello world&#34; end undef hello 定义方法的习惯方法的名词一般都是以小写字母命名的，如果方法是多个名词，那么用下划线" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://polarlights.github.io/post/methods-procs-lambdas-and-closures/" />
<meta property="article:published_time" content="2012-06-24T04:00:00+08:00" />
<meta property="article:modified_time" content="2012-06-24T04:00:00+08:00" />
<meta itemprop="name" content="Method">
<meta itemprop="description" content="方法是一个有名代码块，与一个或多个对象相关联的参数化代码。调用方法时需要给出方法名、所在对象以及零个或多个与有名参数对应的参数值。方法中的最后一个表达式作为方法的返回值。 取消方法的定义取消方法的定义可以使用undef，但是如果想要取消单例方法，不能使用它。在方法或模块中可以使用undef_method。 def hello &#34;hello world&#34; end undef hello 定义方法的习惯方法的名词一般都是以小写字母命名的，如果方法是多个名词，那么用下划线">
<meta itemprop="datePublished" content="2012-06-24T04:00:00&#43;08:00" />
<meta itemprop="dateModified" content="2012-06-24T04:00:00&#43;08:00" />
<meta itemprop="wordCount" content="5133">



<meta itemprop="keywords" content="Ruby,Lambda,Proc," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Method"/>
<meta name="twitter:description" content="方法是一个有名代码块，与一个或多个对象相关联的参数化代码。调用方法时需要给出方法名、所在对象以及零个或多个与有名参数对应的参数值。方法中的最后一个表达式作为方法的返回值。 取消方法的定义取消方法的定义可以使用undef，但是如果想要取消单例方法，不能使用它。在方法或模块中可以使用undef_method。 def hello &#34;hello world&#34; end undef hello 定义方法的习惯方法的名词一般都是以小写字母命名的，如果方法是多个名词，那么用下划线"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->


<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-31475638-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">



</head>

<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">Polarlights</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://polarlights.github.io/">Home</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://polarlights.github.io/post/">Archives</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://polarlights.github.io/tags/">Tags</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://polarlights.github.io/categories/">Categories</a>
          
        
      </li>
    

    
  </ul>
</nav>


  
  






  <link rel="stylesheet" href="/lib/photoswipe/photoswipe.min.css" />
  <link rel="stylesheet" href="/lib/photoswipe/default-skin/default-skin.min.css" />




<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

<div class="pswp__bg"></div>

<div class="pswp__scroll-wrap">
    
    <div class="pswp__container">
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
    </div>
    
    <div class="pswp__ui pswp__ui--hidden">
    <div class="pswp__top-bar">
      
      <div class="pswp__counter"></div>
      <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
      <button class="pswp__button pswp__button--share" title="Share"></button>
      <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
      <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
      
      
      <div class="pswp__preloader">
        <div class="pswp__preloader__icn">
          <div class="pswp__preloader__cut">
            <div class="pswp__preloader__donut"></div>
          </div>
        </div>
      </div>
    </div>
    <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
      <div class="pswp__share-tooltip"></div>
    </div>
    <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
    </button>
    <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
    </button>
    <div class="pswp__caption">
      <div class="pswp__caption__center"></div>
    </div>
    </div>
    </div>
</div>

  

  

  

  <header class="header container">
    <div class="logo-wrapper">
  <a href="/" class="logo">
    
      Polarlights
    
  </a>
</div>

<nav class="site-navbar">
  <ul id="menu" class="menu">
    
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://polarlights.github.io/">Home</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://polarlights.github.io/post/">Archives</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://polarlights.github.io/tags/">Tags</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://polarlights.github.io/categories/">Categories</a>
          

        

      </li>
    

    
    

    
  </ul>
</nav>

  </header>

  <div id="mobile-panel">
    <main id="main" class="main bg-llight">
      <div class="content-wrapper">
        <div id="content" class="content container">
          <article class="post bg-white">
    
    <header class="post-header">
      <h1 class="post-title">Method</h1>
      
      <div class="post-meta">
        <time datetime="2012-06-24" class="post-time">
          2012-06-24
        </time>
        <div class="post-category">
            <a href="https://polarlights.github.io/categories/tech/"> Tech </a>
            <a href="https://polarlights.github.io/categories/ruby/"> Ruby </a>
            
          </div>
        

        
        

        
        
      </div>
    </header>

    
    
<div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Table of Contents</h2>
  <div class="post-toc-content">
    
  </div>
</div>

    
    <div class="post-content">
      <section id="preamble" aria-label="Preamble"><div class="quote-block"><blockquote><p>方法是一个有名代码块，与一个或多个对象相关联的参数化代码。调用方法时需要给出方法名、所在对象以及零个或多个与有名参数对应的参数值。方法中的最后一个表达式作为方法的返回值。</p></blockquote></div></section>
<section class="doc-section level-1"><h2 id="_取消方法的定义">取消方法的定义</h2><p>取消方法的定义可以使用undef，但是如果想要取消单例方法，不能使用它。在方法或模块中可以使用undef_method。</p>
<div class="listing-block"><pre class="highlight"><code class="language-ruby" data-lang="ruby">def  hello
  "hello world"
end

undef hello</code></pre></div></section>
<section class="doc-section level-1"><h2 id="_定义方法的习惯">定义方法的习惯</h2><p>方法的名词一般都是以小写字母命名的，如果方法是多个名词，那么用下划线来分割。方法的定义有一个需要注意的地方：</p>
<div class="ulist"><ul><li>如果方法名以<code>?</code>结尾，那么此类的方法称为"断言式"方法，通常情况下返回false,true或nil，但也不尽然。比如Numberic的nonzero?方法，如果为0则返回nil，否则返回原来的值。当然Ruby中以false和nil判断为False,除此之外的值都是认为是True的。</li><li>方法名以<code>!</code>结尾的方法，则提示该方法是比较危险的，会修改对象的实例变量的值。以<code>!</code>定义的方法通常是可变方法。也有一些方法不以<code>!</code>结尾，但是属于可变方法。</li></ul></div></section>
<section class="doc-section level-1"><h2 id="_操作符方法">操作符方法</h2><p>Ruby本身是很对象化的编程语言，所以操作符其实也是一种方法。对于int,float这些类的操作符是不可继承的。</p>
<p>如何定义这些方法呢?</p>
<div class="listing-block"><pre class="highlight"><code class="language-ruby" data-lang="ruby">def +(other)
  self.age + other
end

def [](index)
  self.ary[index]
end</code></pre></div></section>
<section class="doc-section level-1"><h2 id="_方法的重命名">方法的重命名</h2><p>人有七名八姓，Ruby有方法重命名。方法重命名可以使用不同的方法名对某个方法进行调用。亦然以我们更加容易理解的名称来命名某些方法。比如Range类的include?和member？，Kernel类的raise和fail。 方法重命名并不是进行方法的重载，仅仅是对方法名的重新命名。</p>
<div class="listing-block"><pre class="highlight"><code class="language-ruby" data-lang="ruby">def  hello
  "say hello"
end

alias say_hello hello

def hello
  "can u say hello?"
end</code></pre></div></section>
<section class="doc-section level-1"><h2 id="_我们常见的括号呢">我们常见的括号呢？</h2><p>先举个例子：</p>
<div class="listing-block"><pre class="highlight"><code class="language-ruby" data-lang="ruby">puts "hello world"
puts ("hello world")</code></pre></div>
<p>上面的方法调用有区别吗？在形式上是有区别的，但是实质上是一样的。因为在Ruby中通常是忽略括号的，如果一个方法只有一个甚至没有参数时，括号可以省略；如果方法有多个参数时，原括号也是可以省略的，但是不能说很常见。</p>
<p>但是什么时候必须要括号呢？在有可能引起歧意的时候。 比如"f g x y"，通常ruby会解释成"f(g(x,y))"。为了消除歧义性或为了方便人们的阅读，必要的括号还是很重要的。</p>
<p>看下面的例子:</p>
<div class="listing-block"><pre class="highlight"><code class="language-ruby" data-lang="ruby">seq(2+2) * 2
seq (2+2) * 2</code></pre></div>
<p>上面的例子有区别吗？有。第一个括号表示方法的调用，2+2是方法的参数，而后者是用于分组，seq的参数为 （2+2）* 2。也就是说如果括号紧跟着一个方法名，那么括号里面的变量都是认为是方法的参数的，如果有空格之类的，那么连同括号，都是方法的参数。</p>
<div class="listing-block"><pre class="highlight"><code class="language-ruby" data-lang="ruby">puts(sum 2,2)
puts (sum 2,2)</code></pre></div>
<p>同样的例子。上面的调用是有歧义的，与<code>puts sum 2, 2</code>是没有任何区别的。所以为了正确表达，需要用括号进行分组，在方法名后面用空格分隔。</p></section>
<section class="doc-section level-1"><h2 id="_方法的参数">方法的参数</h2><p>1.带默认参数的方法</p>
<div class="listing-block"><pre class="highlight"><code class="language-ruby" data-lang="ruby">def hello(name, family='Wei')
  "hello, #{name} family"
end

puts hello('david')
puts hello('david','Green')</code></pre></div>
<p>方法的默认参数不一定是常量，还可以是任意的表达式，也可以是实例变量的引用，还可以是对前面定义的参数的引用。参数的默认值是在运行时才进行求值，而不是在解析时。</p>
<p>在Ruby 1.9中放开了原来1.8中规定的默认参数必须在参数列表在最后面的限制，但是仍然要求默认参数必须连续，不能中间插入其它的变量。</p>
<p>2.任意个数的参数</p>
<p>任意个数的参数需要在参数名称前面加上*,它表示这部分传递的是一个数组。btw.数组的个数也有可能为0。</p>
<p>用<code>*</code>打头的参数不能超过一个,一般该参数是放在其它参数的后面，在1.9中稍微放开了些，可以放在其它普通参数的前面，但是必须放在默认参数的后面和含<code>&amp;</code>打头参数的前面。</p>
<p>如果传递的参数为Hash，且Hash为最后一个参数(可以有&amp;代码块)，那么Hash的大括号可以去掉。如果在传递Hash参数的时候是省略了方法的括号的，那么Hash的大括号也要去掉，因为Ruby会认为你给它传递的不是Hash，而是一个代码块，从而运行报错。</p>
<div class="olist arabic"><ol class="arabic"><li>代码块参数</li></ol></div>
<div class="listing-block"><pre class="highlight"><code class="language-ruby" data-lang="ruby">def seq(n,m,o)
  yield n * m + 0
end

seq(2,3,4){ |x| puts x }</code></pre></div>
<p>上面就是一个比较简单的调用代码块参数的例子。只不过代码块参数不是明确写在方法的参数列表中，而是通过yield来进行调用代码块参数。代码块有一个特点:<code>匿名性</code>。它们没有名字，只是通过一个关键字对它进行调用。如果需要明确地方式来控制一个代码块，可以在方法的最后面加上一个参数，并使用<code>&amp;</code>作参数的前缀。这个参数的值有了些许变化，它的值(含&amp;)是Proc对象，在调用的时候不是简单的使用yield来调用，而是需要用Proc的call方法来调用。</p>
<div class="listing-block"><pre class="highlight"><code class="language-ruby" data-lang="ruby">def seq(n,m,o,&amp;b)
  b.call (n * m + o)
end

seq(2,3,4){ |x| puts x }</code></pre></div>
<p>如果上面例子中的b本身是一个Proc对象，那么<code>&amp;</code>是不要的。其它的调用方法也是一样的。</p>
<div class="listing-block"><pre class="highlight"><code class="language-ruby" data-lang="ruby">def seq(n,m,o,b)
  b.call (n * m + o)
end

proc = Proc.new { |x| puts x }

seq(2,3,4,proc)</code></pre></div>
<p>上面说到了，可以使用<code>&amp;</code>将一个代码块转换为proc对象，那么proc对象是否可以变为代码块呢？档案是可以。</p>
<div class="listing-block"><pre class="highlight"><code class="language-ruby" data-lang="ruby">a,b = [1,2,3],[4,5] #并行赋值表达式

sum = a.inject(0) { |total, x| total + x }
sum = b.inject(sum) {|total, x| total + x}</code></pre></div>
<p>上面的代码块是相同的，在运行时需要解析2次，所以我们可以将之定义为一个一个Proc对象，调用它2次。</p>
<div class="listing-block"><pre class="highlight"><code class="language-ruby" data-lang="ruby">a,b = [1,2,3],[4,5]

p = Proc.new { |total, x| total + x }

sum = a.inject(0, &amp;p)
sum = b.inject(sum, &amp;p)</code></pre></div>
<p><code>&amp;</code>通常出现在一个Proc对象之前，它能支持所有支持to_proc方法的对象，像Method,Symbol都有这个方法，所以我们可以这样使用：</p>
<div class="listing-block"><pre class="highlight"><code class="language-ruby" data-lang="ruby">words = ['i','love','ruby']
uppercase = words.map &amp;:upcase
uppercase = words.map {|c| c.upcase} #this line is the same as the one above.</code></pre></div></section>
<section class="doc-section level-1"><h2 id="_procs_and_lambdas">Procs and Lambdas</h2><p>代码块是Ruby的一种句法结构，而不是对象，也不能像对象一样操作。不过，我们可以创建对象来表示代码块。创建对象的方式有proc和lambda，前者的行为与代码块类似，后者的行为则与方法类似。</p>
<p>前面我们举的例子里面就包含着创建Proc对象的方法，而且后面都是包含一个代码块的。实际上，如果不包含代码块，那么它默认指向所在方法所关联的代码块；如果在创建的时候包含着代码块，那么它指向它所关联的代码块。</p>
<p>另外一种创建Proc对象的方法是使用lambda方法，它是Kernel模块的方法，返回的Proc对象是一个lambda而非proc。lambda方法不带参数，但是在调用时必须关联一个代码块。</p>
<div class="literal-block"><pre>is_positive = lambda {|x| x &gt; 0}</pre></div>
<p>第三种是Kernel模块的proc方法，它在1.8中和lambda是同义的，但是在1.9中它是Proc.new的同义词。</p>
<div class="quote-block"><blockquote><p>在Ruby 1.9中，Ruby支持了一种全新的方法，将lambda作为字面量。在1.8中定义lambda是这样的：</p></blockquote></div>
<div class="literal-block"><pre>is_positive = lambda {|x| x &gt; 0}</pre></div>
<div class="quote-block"><blockquote><p>而在Ruby 1.9 中我们我们可以这样做：</p>
<div class="ulist"><ul><li>把lambda方法名替换为 <code>-&gt;</code></li><li>把大括号内的变量，移到{}的前面。</li><li>把参数列表的变量分隔符从<code>||</code>替换为<code>()</code></li></ul></div></blockquote></div>
<div class="literal-block"><pre>is_positive = -&gt; (x){ x &gt; 0 }</pre></div>
<p>在新的定义语法中得到的好处是：我们可以定义默认参数了:<code>zoom = -&gt;(x,y,factor=2){x*factor,y*factor}</code>。另外它还很简洁，产生的代码块，如果要传递给一个需要Proc对象的方法时，需要添加<code>&amp;</code>。</p>
<div class="literal-block"><pre>data.sort {|a,b| a - b}
#变化后:
data.sort &amp;-&gt;(a,b){ a - b }</pre></div>
<p>最小的lambda代码为<code>-&gt;{}</code>，它返回的是nil。</p>
<p><strong>调用proc和lambda的方式除了使用call，还可以使用<code>[]</code>和<code>.()</code></strong> Proc类定义了数组访问操作符，它的工作方式和call是相同的，所以可以使用<code>[]</code>来调用proc对象。还可以使用后面的<code>.()</code>的方式来调用。</p>
<div class="literal-block"><pre>is_positive[3]
is_positive.(3)</pre></div>
<p>如何知道一个Proc对象所需的参数个数呢？使用arity(来源于一元(unary),二元(binary),三元(ternary))</p>
<p>如果参数中不包含<code>*</code>开头的参数，那么arity返回的是不小于0的参数个数。</p>
<p>如果参数中包含<code>*</code>的参数，那么arity返回的是-n-1的负数，负数说明该方法可以接受额外的参数。-n-1是n的互补数。那么有多少个参数是必须需要的呢？取反-1.即-(-n - 1) - 1=n</p></section>
<section class="doc-section level-1"><h2 id="_lambda和proc的区别">Lambda和Proc的区别</h2><p>proc是代码块的对象形式，它的行为就像一个代码块；而lambda的行为略微不同，它的行为更像方法而非代码块。调用一个proc则像对代码块进行yield，而调用lambda则像调用了对象的方法。在Ruby 1.9中可以通过Proc的实例方法<code>lambda?</code>来判断某个实例是一个proc还是lambda。如果返回为真，则为lambda，否则为proc。</p>
<p>除了上面的一些区别，还有什么地方不一样呢？</p>
<p>1 代码块、proc和lambda中的return语句</p>
<p>在一个代码块中的return语句不仅会使代码块返回,还会导致调用它的方法返回。</p>
<div class="listing-block"><pre class="highlight"><code class="language-ruby" data-lang="ruby">def test
  puts "begin of the block"
  10.times { |x| return if x == 3 }
  puts "end of the block"
end

test #the result will not output the 'end of the block'</code></pre></div>
<p>proc与代码块类似，因此在proc中执行return，它也会尝试从代码块所在的方法中返回。</p>
<div class="listing-block"><pre class="highlight"><code class="language-ruby" data-lang="ruby">def test
  puts "begin of the block"
  p = Proc.new {|x| return if x == 3}
  p.call
  puts "end of the block"
end

test #it is the same result as the one above.</code></pre></div>
<p>proc经常在不同方法之间传递，而如果proc中使用return语句可能会达不到预期的目的，因为在调用proc时，在句法上包含该proc的方法已经返回。</p>
<div class="listing-block"><pre class="highlight"><code class="language-ruby" data-lang="ruby">def  procBuilder(msg)
  Proc.new { puts "#{msg}"; return }
end

def test
  puts "begin of the block"
  p = procBuilder('hello')
  p.call  #LocalJumpError: unexpected return
  puts "end of the block"
end

test</code></pre></div>
<p>除了去掉return语句，还可以使用lambda来修复这个问题。前面说到了lambda在调用时更像是一个方法，所以return语句只会从lambda中返回，而调用它的方法不会。</p>
<div class="listing-block"><pre class="highlight"><code class="language-ruby" data-lang="ruby">def procBuilder(msg)
  -&gt;() { puts "#{msg}"; return }
end

def test
  puts "begin of the block"
  p = procBuilder('msg')
  p.call
  puts "end of the block"
end

test</code></pre></div>
<p>顶级的break、redo和next也有相同的行为。在proc和lambda中，retry是禁止使用的:因为它会导致死循环的LocalJumpError异常。</p>
<p>另外在参数上，proc会自动处理传递的参数，少于规定个数的，会自动赋值为nil;
多余规定的参数会被丢弃掉；数组会自动拆开；多个也可以进行打包。 而lambda在处理上则没有如此大的灵活性，参数个数要严格遵守。</p></section>
<section class="doc-section level-0"><h1 id="_closures闭包">Closures闭包</h1><div class="open-block partintro"><div class="content"><p>在Ruby中，proc和lambda都是闭包。那么神马是闭包呢?
闭包表示一个对象即是一个可以调用的函数，也是绑定在这个函数上的变量。(好晦涩Sigh).当创建一个proc或lambda时，得到的Proc对象不仅包含了可执行的代码块，还绑定了代码块中所使用的所有变量。</p>
<p>闭包的要素包括:对象、函数、绑定的变量。 首先它必须是一个对象，第二它还需要可以被调用，最后它的所有变量都是已经被绑定的。</p>
<div class="listing-block"><pre class="highlight"><code class="language-ruby" data-lang="ruby">def multiplier(n)
  -&gt;(data) { data.collect { |x| x * n } }
end

p = multiplier(2)
p.call([1,2,3,4]) #[2, 4, 6, 8]</code></pre></div>
<p>multiplier方法返回一个lambda，它可以在方法返回后继续访问n,它被称为一个闭包。</p>
<p>闭包并不持有它引用的参数，但是持有它所使用的变量并延长了其生命周期。lambda或proc在创建时并不静态绑定所使用的变量，而是在运行时才回去查找变量的值。</p>
<div class="listing-block"><pre class="highlight"><code class="language-ruby" data-lang="ruby">def test(initValue=nil)
  value = initValue
  getter = -&gt; { value }
  setter = -&gt;(x) { value = x }
  return getter,setter
end

getX, setX = test(2)
puts getX[] #the same as getX.call
setX[3]
puts getX[]</code></pre></div>
<p>下面让我们看一个比较晦涩些的代码:</p>
<div class="listing-block"><pre class="highlight"><code class="language-ruby" data-lang="ruby">def test(*args)
  x = nil
  args.map { |x| lambda {|y| x * y} }
end

a, b=test(2,3)
puts a.call(3) #what is the rest? yes, it is 6.</code></pre></div>
<p>上面的代码返回的是一组lambda，所以a,b对应的lambda中的x分别为2和3。所以a在调用的时候就为2*3=6了。</p>
<p>Proc定义了一个binding方法，表示该闭包所使用的绑定，返回一个Binding对象。它作为eval的第二个参数，能为eval函数执行时的代码提供上下文环境。使用Binding对象和eval可以让我们获得闭包的后门，可以修改已经绑定的某些值。</p>
<div class="listing-block"><pre class="highlight"><code class="language-ruby" data-lang="ruby">def multiplier(n)
  -&gt;(data) { data.collect{ |x| x * n } }
end

double = multiplier(2)
puts double([1,2,3])

eval("n=3", double.binding)
puts double([1,2,3]) #it will be 3,6,9</code></pre></div></div></div>
<section class="doc-section level-1"><h2 id="_methods">Methods</h2><p>Ruby的方法和代码块都是可执行的语言构件，但它们不是对象。proc和lambda是代码的对象版本，它们可以被执行。Ruby的方法也可以使用Method的实例来表示，但是通常比直接调用效率要低。Method对象比proc和lambda使用频繁度要低。</p>
<p>Method类不是Proc类的子类，但是它们在行为上很相似.Method对象使用<code>call</code>来表示调用，也有<code>arity</code>方法。Method对象的call方法在调用时使用的是<strong>invocation</strong>,这一点和lambda相同，而proc使用的是yield调用。</p>
<p>Method对象与Proc对象工作方式非常类似，因此常用来替代Proc对象。在需要Proc对象的地方，可以使用<code>Method.to_proc</code>把Method对象转换为Proc对象。所以我们可以在Method对象前面加<code>&amp;</code>，然后使用这个对象取代代码块作参数传递了。</p>
<div class="listing-block"><pre class="highlight"><code class="language-ruby" data-lang="ruby">def sequre(x)
  x ** 2
end

puts (1..10).map(&amp;method(:sequre))</code></pre></div>
<div class="quote-block"><blockquote><p>Method和Proc的一个重要区别是：Method对象不是闭包。</p></blockquote></div>
<p>Ruby的方法不会访问在其范围之外的局部变量，唯一绑定的值是<code>self</code>。在Ruby 1.9中添加了3个新方法:name、owner、receiver。name返回方法的名字。owner返回定义该方法的类。receiver返回该方法绑定的对象。</p>
<p>还有一种无绑定的方法。此类方法的获取方式有2种。一种是通过instance_method方法获取，一种是通过unbind获取。</p>
<div class="example-block"><div class="example"><p>myplus = Fixnum.instance_method("+")
myplus.bind(3) #绑定对象
result = myplus.call(4) #7</p>
<p>other_plus = myplus.unbind.bind(3)
result = other_plus.call(5) #8</p></div></div></section></section>

    </div>

    
    
<div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">Author</span>
    <span class="item-content">polarlights</span>
  </p>
  <p class="copyright-item">
    <span class="item-title">LastMod</span>
    <span class="item-content">
      2012-06-24
      
    </span>
  </p>
  
  <p class="copyright-item">
    <span class="item-title">License</span>
    <span class="item-content"><a rel="license noopener" href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank">CC BY-NC-ND 4.0</a></span>
  </p>
</div>


    
    

    <footer class="post-footer">
      <div class="post-tags">
          <a href="https://polarlights.github.io/tags/ruby/">Ruby</a>
          <a href="https://polarlights.github.io/tags/lambda/">Lambda</a>
          <a href="https://polarlights.github.io/tags/proc/">Proc</a>
          
        </div>

      
      <nav class="post-nav">
        
          <a class="prev" href="/post/reflection-and-metaprograming/">
            
            <i class="iconfont">
              <svg  class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="18" height="18">
  <path d="M691.908486 949.511495l75.369571-89.491197c10.963703-12.998035 10.285251-32.864502-1.499144-44.378743L479.499795 515.267417 757.434875 204.940602c11.338233-12.190647 11.035334-32.285311-0.638543-44.850487l-80.46666-86.564541c-11.680017-12.583596-30.356378-12.893658-41.662889-0.716314L257.233596 494.235404c-11.332093 12.183484-11.041474 32.266891 0.657986 44.844348l80.46666 86.564541c1.772366 1.910513 3.706415 3.533476 5.750981 4.877077l306.620399 321.703933C662.505829 963.726242 680.945807 962.528973 691.908486 949.511495z"></path>
</svg>

            </i>
            <span class="prev-text nav-default">定义</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        
          <a class="next" href="/post/modify-the-gemfile-template/">
            <span class="next-text nav-default">修改Rails默认生成的Gemfile的source</span>
            <span class="prev-text nav-mobile">Next</span>
            
            <i class="iconfont">
              <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="18" height="18">
  <path d="M332.091514 74.487481l-75.369571 89.491197c-10.963703 12.998035-10.285251 32.864502 1.499144 44.378743l286.278095 300.375162L266.565125 819.058374c-11.338233 12.190647-11.035334 32.285311 0.638543 44.850487l80.46666 86.564541c11.680017 12.583596 30.356378 12.893658 41.662889 0.716314l377.434212-421.426145c11.332093-12.183484 11.041474-32.266891-0.657986-44.844348l-80.46666-86.564541c-1.772366-1.910513-3.706415-3.533476-5.750981-4.877077L373.270379 71.774697C361.493148 60.273758 343.054193 61.470003 332.091514 74.487481z"></path>
</svg>

            </i>
          </a>
      </nav>
    </footer>
  </article>

  
  

  
  

  

  
  

  

  

  <div class="disqus-comment">
  <div class="disqus-button" id="load_disqus" onclick="load_disqus()">
    Show Disqus Comments
  </div>
  <div id="disqus_thread"></div>
  <script type="text/javascript">
    var disqus_config = function () {
      this.page.url = "https://polarlights.github.io/post/methods-procs-lambdas-and-closures/";
    };
    function load_disqus() {
      
      
      if (window.location.hostname === 'localhost') return;

      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      var disqus_shortname = 'PolarLights';
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);

      $('#load_disqus').remove();
    };
  </script>
  <noscript>Please enable JavaScript to view the
    <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a>
  </noscript>
  
  </div>

    

  

        </div>
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="icon-links">
  
  
    <a href="mailto:godhuyang@hotmail.com" rel="me noopener" class="iconfont"
      title="email" >
      <svg class="icon" viewBox="0 0 1451 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="36" height="36">
  <path d="M664.781909 681.472759 0 97.881301C0 3.997201 71.046997 0 71.046997 0L474.477909 0 961.649408 0 1361.641813 0C1361.641813 0 1432.688811 3.997201 1432.688811 97.881301L771.345323 681.472759C771.345323 681.472759 764.482731 685.154773 753.594283 688.65053L753.594283 688.664858C741.602731 693.493018 729.424896 695.068979 718.077952 694.839748 706.731093 695.068979 694.553173 693.493018 682.561621 688.664858L682.561621 688.65053C671.644501 685.140446 664.781909 681.472759 664.781909 681.472759L664.781909 681.472759ZM718.063616 811.603883C693.779541 811.016482 658.879232 802.205449 619.10784 767.734955 542.989056 701.759633 0 212.052267 0 212.052267L0 942.809523C0 942.809523 0 1024 83.726336 1024L682.532949 1024 753.579947 1024 1348.948139 1024C1432.688811 1024 1432.688811 942.809523 1432.688811 942.809523L1432.688811 212.052267C1432.688811 212.052267 893.138176 701.759633 817.019477 767.734955 777.248 802.205449 742.347691 811.03081 718.063616 811.603883L718.063616 811.603883Z"></path>
</svg>

    </a>
  
    <a href="https://github.com/polarlights" rel="me noopener" class="iconfont"
      title="github"  target="_blank"
      >
      <svg class="icon" style="" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="36" height="36">
  <path d="M512 12.672c-282.88 0-512 229.248-512 512 0 226.261333 146.688 418.133333 350.08 485.76 25.6 4.821333 34.986667-11.008 34.986667-24.618667 0-12.16-0.426667-44.373333-0.64-87.04-142.421333 30.890667-172.458667-68.693333-172.458667-68.693333C188.672 770.986667 155.008 755.2 155.008 755.2c-46.378667-31.744 3.584-31.104 3.584-31.104 51.413333 3.584 78.421333 52.736 78.421333 52.736 45.653333 78.293333 119.850667 55.68 149.12 42.581333 4.608-33.109333 17.792-55.68 32.426667-68.48-113.706667-12.8-233.216-56.832-233.216-253.013333 0-55.893333 19.84-101.546667 52.693333-137.386667-5.76-12.928-23.04-64.981333 4.48-135.509333 0 0 42.88-13.738667 140.8 52.48 40.96-11.392 84.48-17.024 128-17.28 43.52 0.256 87.04 5.888 128 17.28 97.28-66.218667 140.16-52.48 140.16-52.48 27.52 70.528 10.24 122.581333 5.12 135.509333 32.64 35.84 52.48 81.493333 52.48 137.386667 0 196.693333-119.68 240-233.6 252.586667 17.92 15.36 34.56 46.762667 34.56 94.72 0 68.522667-0.64 123.562667-0.64 140.202666 0 13.44 8.96 29.44 35.2 24.32C877.44 942.592 1024 750.592 1024 524.672c0-282.752-229.248-512-512-512"></path>
</svg>

    </a>


<a href="https://polarlights.github.io/index.xml" rel="noopener alternate" type="application/rss&#43;xml"
    class="iconfont" title="rss" target="_blank">
    <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="30" height="30">
  <path d="M819.157333 1024C819.157333 574.592 449.408 204.8 0 204.8V0c561.706667 0 1024 462.293333 1024 1024h-204.842667zM140.416 743.04a140.8 140.8 0 0 1 140.501333 140.586667A140.928 140.928 0 0 1 140.074667 1024C62.72 1024 0 961.109333 0 883.626667s62.933333-140.544 140.416-140.586667zM678.784 1024h-199.04c0-263.210667-216.533333-479.786667-479.744-479.786667V345.173333c372.352 0 678.784 306.517333 678.784 678.826667z"></path>
</svg>

  </a>
   
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - <a class="theme-link" href="https://github.com/xianmin/hugo-theme-jane">Jane</a>
  </span>

  <span class="copyright-year">
    &copy;
    
      2012 -
    2020
    <span class="heart">
      
      <i class="iconfont">
        <svg class="icon" viewBox="0 0 1025 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="14" height="14">
  <path d="M1000.1 247.9c-15.5-37.3-37.6-70.6-65.7-98.9-54.4-54.8-125.8-85-201-85-85.7 0-166 39-221.4 107.4C456.6 103 376.3 64 290.6 64c-75.1 0-146.5 30.4-201.1 85.6-28.2 28.5-50.4 61.9-65.8 99.3-16 38.8-24 79.9-23.6 122.2 0.7 91.7 40.1 177.2 108.1 234.8 3.1 2.6 6 5.1 8.9 7.8 14.9 13.4 58 52.8 112.6 102.7 93.5 85.5 209.9 191.9 257.5 234.2 7 6.1 15.8 9.5 24.9 9.5 9.2 0 18.1-3.4 24.9-9.5 34.5-30.7 105.8-95.9 181.4-165 74.2-67.8 150.9-138 195.8-178.2 69.5-57.9 109.6-144.4 109.9-237.3 0.1-42.5-8-83.6-24-122.2z"
   fill="#8a8a8a"></path>
</svg>

      </i>
    </span><span class="author">
        polarlights
        
      </span></span>

  
  

  
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont">
        
        <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="35" height="35">
  <path d="M510.866688 227.694839 95.449397 629.218702l235.761562 0-2.057869 328.796468 362.40389 0L691.55698 628.188232l241.942331-3.089361L510.866688 227.694839zM63.840492 63.962777l894.052392 0 0 131.813095L63.840492 195.775872 63.840492 63.962777 63.840492 63.962777zM63.840492 63.962777"></path>
</svg>

      </i>
    </div>
  </div>
  
<script type="text/javascript" src="/lib/jquery/jquery-3.2.1.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout-1.0.1.min.js"></script>




<script type="text/javascript" src="/js/main.638251f4230630f0335d8c6748e53a96f94b72670920b60c09a56fdc8bece214.js" integrity="sha256-Y4JR9CMGMPAzXYxnSOU6lvlLcmcJILYMCaVv3Ivs4hQ=" crossorigin="anonymous"></script>












  
    <script type="text/javascript" src="/js/load-photoswipe.js"></script>
    <script type="text/javascript" src="/lib/photoswipe/photoswipe.min.js"></script>
    <script type="text/javascript" src="/lib/photoswipe/photoswipe-ui-default.min.js"></script>
  














  <script src="/js/prism.js"></script>

  <script src="/js/fix-adoc.js"></script>


</body>

</html>